# rubber-ducks Team-29 Backend
### Backend Developer Rotation:
* Phase 1: Marco Clark
* Phase 2: 
* Phase 3: 
### Description
- This is the backend for our semester-long project. We will be using Java Spark and deploying onto a dokku server. This application will send and receive http requests and data will persist in a POSTGRESSQL database.
### Deploy Instructions
- There exists a `backend-dokku` branch, which is necessary to format the file structure in a way that is dokku-friendly
- First, you should set up the dokku remote on your computer. You can do this by running:
    ```
    git remote add dokku dokku@dokku.cse.lehigh.edu:team-rubber-ducks
    ```
    then inspect the remote with `git remote -v` and then run `git fetch origin`
- Next, we need to grab the static web files that are generated by React. Either ask the current web developer (or enter the web branch and do it yourself) to run `npm install; npm run build` in the directory `web/buzz-frontend` on the web branch. Now that the web files are compiled for prod, navigate to `backend/src/main/resources/web` on the backend branch. To pull the web code in, run `git checkout web -- web/buzz-frontend`. This will pull in a bunch of unecessary files, but since the `build` directory we are targeting does not exist in git, this is the best we can do for now. Now we can drag and drop files so the only thing in the `resources/web` folder are the contents of the `build` folder. Delete everything else. The html and js files will be a bunch of garbage, so don't even try reading them, but they are the correct files for the web frontend.
- After you make your changes on the `backend` branch and pull in the static web code using the above method, we should now be ready to commit our code into the backend-dokku branch for deployment
    - After that, pull the updated backend into `backend-dokku` by running the following:
    ```
        git checkout backend-dokku 
        git read-tree backend:backend
        git commit -m "{whatever commit message reflects the changes}"
        git push origin backend-dokku
    ```
    - WARNING: After the 4th command above, git may still say that there are uncomitted changes. Commit but DO NOT push these changes yet or the next command will not depoly properly (or at all)
- After updated code is in the `backend-dokku` branch, it can now be pushed to the dokku remote server by running:
    ```
    git push dokku backend-dokku:master
    ```
- Doing this will cause the application to start running on `https://team-rubber-ducks.dokku.cse.lehigh.edu`. Navigate here to view the application.\
\
**IMPORTANT: The following commands assume that you correctly setup your ssh keys with dokku** You can correctly set that up by running the following:
    ```
    ssh-copy-id -i ~/.ssh/id_ed25519.pub mac325@dokku.cse.lehigh.edu
    ```

- When we want to stop the application from running, run the following on your localhost:
    ```
    ssh -i ~/.ssh/id_ed25519 -t dokku@dokku.cse.lehigh.edu 'ps:stop team-rubber-ducks'
    ```
- To start the application again, **do not** just re-run ```git push dokku backend-dokku:master```, you should run:
    ```
    ssh -i ~/.ssh/id_ed25519 -t dokku@dokku.cse.lehigh.edu 'ps:stop team-rubber-ducks'
    ```

### Tips for the Phase 2 Developer:
- start early! Everything we do here is critical to making sure other team members can get their work done on time. 
- Think about renaming the routes to include the api designation and version number that Prof. Urban talked about in class. It would look something like `.../api/v1/proposals`, `.../api/v1/proposals/1`, etc...
- Potentially take more ownership over the dokku app and don't leave it running 24/7. I feel like we have had it running the entire phase, but you could potentially remind the other developers to communicate about starting/stopping the app when not in use.
